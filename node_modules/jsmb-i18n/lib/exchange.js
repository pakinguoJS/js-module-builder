var fs = require('fs');
var path = require('path');
var XM = require('xml-mapping');
var mkdir = require('jsmb-util').mkdir;

module.exports = {
    po2xml: po2xml
};


function po2xml(src, dest){
    // 获取翻译文件
    var matches = fs.readFileSync(src, 'utf8').match(/msgid (""((\r|\n|\r\n)"[^\n]*")+|"[^\n]*")(\r|\n|\r\n)msgstr (""((\r|\n|\r\n)"[^\n]*")+|"[^\n]*")/g);

    var XMLTMP = '<?xml version="1.0" encoding="utf-8"?>\n<resources xmlns:android="http://schemas.android.com/apk/res/android">\n{items}</resources>';
    var XMLITEM = '    <string name="{key}">{value}</string>\n';

    var output = "";
    var tmp;

    for (var i = 0, l = matches.length; i < l; i++) {
        tmp = matches[i].replace(/"(\r|\n|\r\n)"/g, '').replace(/msgid "|("$)/g, "").replace(/"(\r|\n|\r\n)msgstr "/, '||').split('||');
        if (tmp[0] !== '' && tmp[1] !== '') {
            output += XMLITEM.replace("{key}", tmp[0].replace(/"/g, '\"')).replace("{value}", tmp[1]);
        }

    }

    fs.writeFileSync(dest, XMLTMP.replace("{items}", output), "utf-8");

}