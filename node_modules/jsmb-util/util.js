var fs = require('fs');
var path = require('path');

module.exports = (function(){

    function mkdir(dst){
        if(!fs.existsSync(dst)){
            mkdir(path.dirname(dst));
            fs.mkdirSync(dst);
        }
    }

    function cp(from, to){
        if(!fs.existsSync(from)){
            if(fs.existsSync(to)){
                rm(to);
            }
            return;
        }
        if(fs.statSync(from).isDirectory()){
            // if is a directory, mkdir
            mkdir(to);

            // 递归
            var ll = fs.readdirSync(from);
            ll.forEach(function(file){
                var filepath = path.join(from, file);
                if(fs.statSync(filepath).isDirectory()){
                    cp(filepath, path.join(to, file))
                }else{
                    cpinner(filepath, path.join(to, file));
                }
            });
        }else{
            cpinner(from, to);
        }

        function cpinner(f, t){
            var dir = path.dirname(t);
            mkdir(dir);
            fs.writeFileSync(t, fs.readFileSync(f));
        }
    }


    function rm(src){
        if(!fs.existsSync(src)){
            return;
        }
        if(fs.statSync(src).isDirectory()){
            var ll = fs.readdirSync(src);
            ll.forEach(function(name){
                rm(path.join(src, name));
            })
            fs.rmdirSync(src);
        }else{
            fs.unlinkSync(src);
        }
    }

    return {
        mkdir: mkdir,
        cp: cp,
        rm: rm
    };
})();